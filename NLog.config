<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.nlog-project.org/schemas/NLog.xsd NLog.xsd"
      autoReload="true"
      throwExceptions="false"
      internalLogLevel="Info"
      internalLogFile="c:\temp\nlog-internal.log">

	<variable name="logDirectory" value="${basedir}/logs" />
	<variable name="logFormat" value="${longdate} | ${level:uppercase=true:padding=5} | ${logger:shortName=true} | ${message} ${exception:format=ToString}" />
	<variable name="detailedFormat" value="${longdate} | ${level:uppercase=true:padding=5} | ${logger} | ${threadid} | ${message} ${exception:format=ToString}" />

	<targets async="true">

		<!-- Main application log file (daily rotation) -->
		<target name="mainFile" xsi:type="File"
				fileName="${logDirectory}/${shortdate}.log"
				layout="${logFormat}"
				archiveFileName="${logDirectory}/archives/{#}.log"
				archiveEvery="Day"
				archiveNumbering="Rolling"
				maxArchiveFiles="30"
				keepFileOpen="false"
				encoding="utf-8" />

		<!-- Error-only log file -->
		<target name="errorFile" xsi:type="File"
				fileName="${logDirectory}/errors-${shortdate}.log"
				layout="${detailedFormat}"
				archiveFileName="${logDirectory}/archives/errors-{#}.log"
				archiveEvery="Day"
				maxArchiveFiles="30" />

		<!-- Detailed debug log file -->
		<target name="debugFile" xsi:type="File"
				fileName="${logDirectory}/debug-${shortdate}.log"
				layout="${detailedFormat}"
				archiveFileName="${logDirectory}/archives/debug-{#}.log"
				archiveEvery="Day"
				maxArchiveFiles="15" />

		<!-- Console output with colors -->
		<target name="coloredConsole" xsi:type="ColoredConsole"
				layout="${logFormat}"
				useDefaultRowHighlightingRules="true">
			<highlight-row condition="level == LogLevel.Fatal" foregroundColor="Red" backgroundColor="White" />
			<highlight-row condition="level == LogLevel.Error" foregroundColor="Red" />
			<highlight-row condition="level == LogLevel.Warn" foregroundColor="Yellow" />
			<highlight-row condition="level == LogLevel.Info" foregroundColor="Green" />
			<highlight-row condition="level == LogLevel.Debug" foregroundColor="Gray" />
			<highlight-row condition="level == LogLevel.Trace" foregroundColor="DarkGray" />
		</target>

		<!-- Database target (optional) -->
		<!--
    <target name="database" xsi:type="Database">
      <connectionString>Your_Database_Connection_String</connectionString>
      <commandText>
        INSERT INTO Logs (TimeStamp, Level, Logger, Message, Exception, MachineName, ThreadId) 
        VALUES (@timeStamp, @level, @logger, @message, @exception, @machineName, @threadId);
      </commandText>
      <parameter name="@timeStamp" layout="${date}" />
      <parameter name="@level" layout="${level}" />
      <parameter name="@logger" layout="${logger}" />
      <parameter name="@message" layout="${message}" />
      <parameter name="@exception" layout="${exception:format=ToString}" />
      <parameter name="@machineName" layout="${machinename}" />
      <parameter name="@threadId" layout="${threadid}" />
    </target>
    -->

	</targets>

	<rules>
		<!-- Log all errors and above to error file and console -->
		<logger name="*" minlevel="Error" writeTo="errorFile,coloredConsole" final="true" />

		<!-- Log warnings to main file and console -->
		<logger name="*" minlevel="Warn" writeTo="mainFile,coloredConsole" />

		<!-- Log info messages to main file -->
		<logger name="*" minlevel="Info" writeTo="mainFile" />

		<!-- Detailed debugging for your data access layer -->
		<logger name="MISReports_Api.DAL.*" minlevel="Debug" writeTo="debugFile" />

		<!-- Trace level logging for specific namespaces (very verbose) -->
		<logger name="MISReports_Api.DAL.SolarProgressClarification.DetailedDao" minlevel="Trace" writeTo="debugFile" />

		<!-- Suppress Microsoft framework logs to reduce noise -->
		<logger name="Microsoft.*" minlevel="Warn" final="true" />
		<logger name="System.*" minlevel="Warn" final="true" />

	</rules>
</nlog>